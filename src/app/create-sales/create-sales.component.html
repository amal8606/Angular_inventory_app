<button
  (click)="addSale = true"
  class="m-3 hover:-translate-y-1 hover:scale-110 duration-300 py-2 mr-2 px-3 inline-flex justify-center disabled:bg-slate-400 disabled:cursor-not-allowed items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm"
>
  Add Sale
  <i class="fa-sharp fa-solid fa-plus"></i>
</button>
<div
  style="position: fixed; top: 3rem; z-index: 1000; left: 50rem; bottom: 10rem"
>
  <div
    *ngIf="addSale"
    class="w-full h-full fixed top-10 left-6 z-[60] overflow-x-hidden overflow-y-auto"
  >
    <div
      class="opacity-100 duration-500 opacity-0 transition-all lg:max-w-[85rem] m-3 lg:mx-auto bottom-4 mx-auto"
    >
      <div class="flex flex-col bg-white border shadow-sm rounded-xl">
        <div
          class="flex justify-between items-center py-3 px-4 border-b dark:border-gray-700"
        >
          <h3 class="font-bold text-white">Add Product</h3>
          <button
            (click)="closeSales()"
            type="button"
            class="hs-dropdown-toggle inline-flex flex-shrink-0 justify-center items-center h-8 w-8 rounded-md text-gray-500 hover:text-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 focus:ring-offset-white transition-all text-sm dark:focus:ring-gray-700 dark:focus:ring-offset-gray-800"
          >
            <span class="sr-only">Close</span>
            <svg
              class="w-3.5 h-3.5"
              width="8"
              height="8"
              viewBox="0 0 8 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0.258206 1.00652C0.351976 0.912791 0.479126 0.860131 0.611706 0.860131C0.744296 0.860131 0.871447 0.912791 0.965207 1.00652L3.61171 3.65302L6.25822 1.00652C6.30432 0.958771 6.35952 0.920671 6.42052 0.894471C6.48152 0.868271 6.54712 0.854471 6.61352 0.853901C6.67992 0.853321 6.74572 0.865971 6.80722 0.891111C6.86862 0.916251 6.92442 0.953381 6.97142 1.00032C7.01832 1.04727 7.05552 1.1031 7.08062 1.16454C7.10572 1.22599 7.11842 1.29183 7.11782 1.35822C7.11722 1.42461 7.10342 1.49022 7.07722 1.55122C7.05102 1.61222 7.01292 1.6674 6.96522 1.71352L4.31871 4.36002L6.96522 7.00648C7.05632 7.10078 7.10672 7.22708 7.10552 7.35818C7.10442 7.48928 7.05182 7.61468 6.95912 7.70738C6.86642 7.80018 6.74102 7.85268 6.60992 7.85388C6.47882 7.85498 6.35252 7.80458 6.25822 7.71348L3.61171 5.06702L0.965207 7.71348C0.870907 7.80458 0.744606 7.85498 0.613506 7.85388C0.482406 7.85268 0.357007 7.80018 0.264297 7.70738C0.171597 7.61468 0.119017 7.48928 0.117877 7.35818C0.116737 7.22708 0.167126 7.10078 0.258206 7.00648L2.90471 4.36002L0.258206 1.71352C0.164476 1.61976 0.111816 1.4926 0.111816 1.36002C0.111816 1.22744 0.164476 1.10028 0.258206 1.00652Z"
                fill="currentColor"
              />
            </svg>
          </button>
        </div>
        <div class="p-4 overflow-y-auto flex">
          <div *ngIf="!showClient" class="max-w-[100px] mx-auto mt-5 mb-2">
            <button 
            (click)="showClient=true"
            class="hover:bg-blue-400 hover:p-5 hover:-translate-y-1 duration-300 bg-blue-100 rounded-full p-4"><i class="fa-solid fa-user-plus fa-2xl"></i></button>
            <p >click add User</p>
          </div>
          <div class="max-w-[40rem]" *ngIf="showClient">
            <div>
              <label
                for="hs-leading-icon"
                class="block text-sm font-medium mb-2 text-black"
                ><i class="fa-sharp fa-solid fa-magnifying-glass"></i> search For client</label
              >
              <div class="relative">
                <input
                  [(ngModel)]="searchValue"
                  (input)="searchName()"
                  type="text"
                  id="hs-leading-icon"
                  name="hs-leading-icon"
                  class="py-3 px-4 pl-11 block w-full border-red-500 shadow-md rounded-md text-sm focus:z-30 focus:border-blue-500 focus:ring-red-800"
                  placeholder="Enter client name"
                />
                <div
                  class="absolute inset-y-0 left-0 flex items-center pointer-events-none z-20 pl-4"
                ></div>
              </div>

              <div >
                <ng-container *ngIf="showDiv" >
                  <div class="max-h-[200px] overflow-y-auto">
                    <div *ngFor="let client of clients$ | async" >
                      <div
                        (click)="
                          selectClient(
                            client.id,
                            client.first_name + ' ' + client.last_name
                          )
                        "
                        class="hover:bg-gray-500 hover:text-red-300 max-w-[20rem]"
                      >
                        <p>{{ client.first_name }} {{ client.last_name }}</p>
                      </div>
                  </div>
                  </div>
                

                    <div class="bg-blue-50">
                      <button
                     (click)="reDirect()"
                      ><i class="fa-solid fa-user-plus"></i>create user</button>
                    </div>
              </ng-container>

              </div>
            </div>
            <div [hidden]="viewProducts">
              <p class="text-red-400">
                <i
                  class="fa-solid fa-triangle-exclamation"
                  style="color: rgb(21, 4, 68)"
                ></i>
                Select one client to make a purchase
              </p>
            </div>
            <div class="m-3" *ngIf="viewProducts">
              <label
                for="hs-leading-icon"
                class="block text-sm font-medium mb-2 text-black"
                ><i class="fa-sharp fa-solid fa-magnifying-glass"></i> search For products</label
              >
              <input
                [(ngModel)]="searchProductValue"
                (input)="showtable()"
                type="text"
                id="hs-leading-icon"
                name="hs-leading-icon"
                class="py-3 px-4 pl-11 block w-full border-gray-500 shadow-sm rounded-md text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500"
                placeholder="Enter product name"
              />
              <div class="max-h-[300px] overflow-y-auto m-2">
                <table
                  *ngIf="Showtable"
                  class="min-w-full divide-y divide-white mt-5"
                >
                  <thead class="bg-slate-400">
                    <th>Id</th>
                    <th>name</th>
                    <th>Available stock</th>
                    <th></th>
                    <th>
                      <i
                        (click)="Showtable = false"
                        class="fa-regular fa-rectangle-xmark fa-lg"
                      ></i>
                    </th>
                  </thead>
                  <tbody
                    *ngFor="let product of products$ | async"
                    class="text-black bg-gray-200"
                  >
                    <tr>
                      <td>{{ product.id }}</td>
                      <td class="px-3 py-2 whitespace-nowrap">
                        {{ product.name }}
                      </td>
                      <td
                        *ngIf="product.stock > 0"
                        class="px-3 py-4 whitespace-nowrap"
                      >
                        {{ product.stock }}
                      </td>
                      <td
                        *ngIf="product.stock == 0"
                        class="text-red-400 px-3 py-4 whitespace-nowrap"
                      >
                        Sold Out
                      </td>
                      <td class="px-3 py-2 whitespace-nowrap">
                        <button
                          [hidden]="product.stock == 0"
                          (click)="addProductTolist(product)"
                          class="m-3 hover:-translate-y-1 hover:scale-110 duration-300 py-2 mr-2 px-3 inline-flex justify-center disabled:bg-slate-400 disabled:cursor-not-allowed items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm"
                        >
                          <i class="fa-sharp fa-solid fa-plus"></i>
                        </button>
                      </td>
                      <td class="px-3 py-4 whitespace-nowrap"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div
            class="max-w-[40rem] mx-auto  w-[55rem] top-0 pt-3 rounded-md"
          >
            <div class="max-w-[200px] mx-auto top-3">
              <h2>
                cart
                <i
                  class="fa-sharp fa-solid fa-cart-shopping"
                  style="color: rgb(211, 20, 20)"
                ></i>
              </h2>
            </div>
            <hr class="text-red-500" />
            <div
              class="mx-auto max-w-[300px] mt-5"
              *ngIf="saleProducts.length == 0"
            >
              <i
                class="fa-sharp fa-solid fa-circle-info fa-2xl"
                style="margin-left: 9rem"
              ></i>
              <p class="text-blue-600 mt-3">
                Your cart is empty please add products...
              </p>
            </div>
            <div class="grid m-2">
              <ul class="max-h-[300px] overflow-y-auto ">
              <div >
                <form action="" [formGroup]="saleForm">
                  <ng-container formArrayName="products">
                    <ng-container
                      *ngFor="
                        let product of saleProducts.controls;
                        let i = index
                      "
                    >
                    <li class=" m-1 bg-blue-100 p-3">
                      <div class="flex justify-between" formGroupName="{{ i }}">
                      
                        <div class="max-w-[6rem]">
                          <p class="font-bold ">{{product.get('name')?.value}}</p>
                          <p>Unit Price</p>
                          <p>{{product.get('price')?.value| currency:('USD')}}</p>
                        </div>
                        <div class="ms-3 mt-3">
                          <div class="flex">
                            <button 
                            (click)="minusQuantity(i)"
                            class="bg-gray-300 rounded-full m-2 p-3"><i class="fa-solid fa-minus"></i></button>

                            <input
                            (input)="updateTotal()"
                              formControlName="quantity"
                              type="number"
                              class="py-3 px-3 pl-5 block w-full border-gray-200 shadow-sm rounded-md text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:text-gray-400 max-w-[4rem]"
                            />
                            <button
                            (click)="plusQuantity(i)"
                            class="bg-gray-300 rounded-full m-2 p-3"><i class="fa-sharp fa-solid fa-plus"></i></button>
  
                          </div>
                        
                        </div>
                        <div>
                          <button
                          (click)="removeProduct(i)"
                          class="top-1 mr-1 ms-5 hover:-translate-y-1 hover:scale-110 duration-300 py-1 px-3 disabled:bg-slate-400 disabled:cursor-not-allowed items-center gap-2 rounded-md border border-transparent font-semibold bg-red-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm max-h-[2rem]"
                        >
                          <i class="fa-sharp fa-solid fa-trash"></i>
                        </button>
                        <p>{{(product.get('price')?.value ) * (product.get('quantity')?.value)| currency:('USD')}}</p>
                        </div>
                       
                      </div>
                    
                      <div
                        *ngIf="saleProducts.at(i).get('quantity')?.errors?.['max']"
                        class="text-red-500 m-2"
                      >
                        <p>
                          <i
                            class="fa-solid fa-triangle-exclamation"
                            style="color: rgb(21, 4, 68)"
                          ></i>
                          Stock limit exceed...
                        </p>
                      </div>
                    </li>
                    </ng-container>
                  </ng-container>
                </form>
                
                <div class="bg-slate-200"></div>
              </div>
              <hr>
            </ul>
              <div class="m-6" *ngIf="saleProducts.length > 0">
                <p class="font-bold text-green-800">subtotal: {{totalamount|currency:('USD')}} </p>
                <button
                  [disabled]="!saleForm.valid"
                  (click)="sendNewSales()"
                  class="disabled:cursor-not-allowed py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800 disabled:bg-slate-400"
                >
                  Confirm
                </button>
                <button
                  (click)="clearCart()"
                  class="disabled:cursor-not-allowed py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border border-transparent font-semibold bg-red-300 text-white ms-3 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all text-sm dark:focus:ring-offset-gray-800 disabled:bg-slate-400"
                >
                  clear
                </button>
              </div>
            </div>
          
          </div>
        </div>
        <div
          class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-gray-700"
        >
          <button
            (click)="closeSales()"
            type="button"
            class="hs-dropdown-toggle py-3 px-4 inline-flex justify-center items-center gap-2 rounded-md border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white focus:ring-blue-600 transition-all text-sm hover:bg-slate-800 hover:text-red-400"
            data-hs-overlay="#hs-basic-modal"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
